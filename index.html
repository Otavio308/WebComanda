<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comanda Digital</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" type="image/png" href="assets/logo.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="main-container">
        <aside class="off-canvas-menu" id="off-canvas-menu">
            <div class="sidebar-header">
                <div class="user-info">
                    <i class="fas fa-user"></i>
                    <span id="user-name">Carregando...</span>
                </div>
            </div>
            <div class="sidebar-links">
                <button class="menu-link" id="btn-mesa-menu">
                    <i class="fas fa-utensil-spoon menu-icon"></i>
                    <span id="mesa-display-menu">Mesa: #</span>
                </button>
                <a href="pedidos.html" class="menu-link">
                    <i class="fas fa-list-alt menu-icon"></i>
                    Pedidos Ativos
                </a>
            </div>
            <button class="logout-link menu-link" id="btn-logout" type="button">
                <i class="fas fa-arrow-left menu-icon"></i>
                Sair da conta
            </button>
        </aside>
        
        <div class="overlay" id="overlay"></div>

        <header class="main-header">
            <div class="header-content">
                <button class="menu-button" id="menu-button">
                    <i class="fas fa-bars"></i>
                </button>
                
                <div class="search-container">
                    <input type="text" id="search-bar" placeholder="Buscar no menu...">
                    <i class="fas fa-search search-icon"></i>
                </div>
            </div>
        </header>

        <main class="content-wrapper">
            
            <div class="dropdown-container">
                <div class="category-menu-bar">
                    <div class="menu-dropdown-toggle" data-type="Pratos" id="toggle-pratos">
                        <i class="fas fa-utensils menu-icon"></i>
                        <span>Pratos</span>
                        <i class="fas fa-chevron-down arrow-icon"></i>
                    </div>
                    
                    <div class="menu-dropdown-toggle" data-type="Bebidas" id="toggle-bebidas">
                        <i class="fas fa-glass-martini-alt menu-icon"></i>
                        <span>Bebidas</span>
                        <i class="fas fa-chevron-down arrow-icon"></i>
                    </div>
                </div>
                
                <div class="dropdown-overlay" id="dropdown-overlay">
                    <div class="dropdown-content" id="dropdown-content">
                    </div>
                </div>
            </div>

            <section class="main-section">
                <div class="product-grid" id="product-grid">
                </div>
                
                <div class="comanda-summary" id="comanda-summary">
                    <div class="mesa-header">
                        <span class="mesa-label">Mesa Atual:</span>
                        <span class="mesa-number" id="mesa-summary-display-header">#</span>
                        <button class="change-mesa-btn" id="change-mesa-btn-summary"><i class="fas fa-edit"></i></button>
                    </div>

                    <div class="summary-list" id="summary-list">
                        </div>

                    <div class="summary-footer">
                        <div class="summary-info total-info">
                            <span class="summary-price-label">TOTAL:</span>
                            <span class="summary-price" id="total-price">R$ 0,00</span>
                        </div>
                        <button class="fazer-pedido-button" id="fazer-pedido-button" style="display: none;">
                            Fazer Pedido
                        </button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <div class="mesa-modal" id="mesa-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title-mesa">Selecione o número da mesa</h3>
            </div>
            <input type="number" id="mesa-number-input" min="1" placeholder="Nº da Mesa" class="mesa-input">
            <button id="save-mesa-button">Ir</button>
        </div>
    </div>

    <div class="notes-modal" id="notes-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Anotações para o Pedido</h3>
                <span class="close-button" id="close-notes-modal-button">&times;</span>
            </div>
            <h4 id="notes-item-name">Item: </h4>
            <textarea id="notes-textarea" placeholder="Adicionar anotações sobre o item (ex: 'sem cebola', 'ponto da carne')..."></textarea>
            <button id="save-notes-button">Salvar Anotação</button>
        </div>
    </div>

    <!-- Adiciona config + AuthService (necessário para o botão de logout funcionar) -->
    <script src="js/configP.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/script.js"></script>

    <script>
        // Arrow function nomeada "SairDaConta" que executa o logout e redireciona ao login
        const SairDaConta = () => {
            // Se AuthService estiver disponível use a função centralizada
            if (window.AuthService && typeof window.AuthService.logout === 'function') {
                window.AuthService.logout();
                return;
            }

            // Fallback: remove dados de autenticação e redireciona
            try {
                localStorage.removeItem('auth_token');
                localStorage.removeItem('user_data');
                localStorage.removeItem('login_time');
            } catch (e) { /* ignore */ }
            window.location.href = '/ComandaWeb/Login.html';
        };
        // Torna disponível globalmente caso precise chamar de outros scripts
        window.SairDaConta = SairDaConta;

        document.addEventListener('DOMContentLoaded', function() {
            // Atualiza o nome do usuário no menu
            const updateUserName = () => {
                const userData = AuthService.getUserData();
                const userNameElement = document.getElementById('user-name');
                
                if (userData && userData.name) {
                    userNameElement.textContent = userData.name;
                } else {
                    userNameElement.textContent = 'Usuário';
                }
            };

            // Atualiza o nome assim que a página carrega
            updateUserName();

            // Associa o botão ao SairDaConta
            const btnLogout = document.getElementById('btn-logout');
            if (btnLogout) {
                btnLogout.addEventListener('click', function(e) {
                    e.preventDefault();
                    AuthService.logout();
                });
            }
        });
    </script>
</body>
</html>